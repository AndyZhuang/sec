version: '2'
services:
  app:
    build: .
    depends_on:
      - db
    restart: unless-stopped

    volumes:
      - .:/opt/trainers-hub

    env_file: .env


  db:
    image: postgres

    env_file: .env
    environment:
      POSTGRES_DB: trainers-hub_development

    volumes:
      - ./pgdata:/var/lib/postgresql/data

  redis:
    image: redis

  nginx:
    image: irasnyd/nginx_s3_streaming_zip

    ports:
      - '3000:80'

    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./nginx/init:/init
      - ./public:/var/www/html
